<?xml version="1.0" ?>
<plan name="LabAssistant">
    <!-- <stage name="StageInitialization" type="other" delay="0">
        <step type="prompt" delay="3" prompt="WELCOME_WAIT">WELCOME_WAIT</step>
        <step type="prompt" delay="2" prompt="WELCOME_CONTEXT">WELCOME_CONTEXT</step>
        <step type="presence_gate" delay="0" required_participants="2">WAIT_FOR_STUDENTS</step>
        <step type="prompt" delay="0" prompt="WELCOME_READY_PROMPT">WELCOME_READY_PROMPT</step>
        <step type="ready_secret" delay="0" pattern="(?i)^\s*ready\s*$" required_participants="2" ack_prompt="READY_ACK">INIT_READY</step>
    </stage> -->
    <stage name="StagePart1" type="other" delay="0">
        <!-- <step type="send_command" delay="0" state_key="CURRENT_PART_COMMAND" state_value="SHOW_VLAB1">SHOW_VLAB1</step>
        <step type="prompt" delay="5" prompt="PART1_QUESTION">PART1_QUESTION</step>
        <step type="prompt" delay="0" prompt="PART1_COLLAB">PART1_COLLAB</step>
        <step type="ready_secret" delay="0" pattern="(?i)^\s*ready\s*:\s*part1\s*$" required_participants="2" secret_property="PART1_SECRET_WORD" secret_flag="PART1_SECRET_TRIGGERED" ack_prompt="READY_ACK">PART1_READY</step>
        <step type="prompt" delay="0" prompt="PART1_SUBMIT_PROMPT">PART1_SUBMIT_PROMPT</step>
        <step type="reaction" delay="0" attempts="3" expected_reactions="${PART1_EXPECTED|A+B-&gt;2C}" secret_flag="PART1_SECRET_TRIGGERED" success_prompt="PART1_CORRECT" retry_prompt="PART1_RETRY" failure_prompt="PART1_FAILURE" reactant_feedback_prompt="PART1_REACTANT_FEEDBACK" product_feedback_prompt="PART1_PRODUCT_FEEDBACK" stoichiometry_feedback_prompt="PART1_STOICHIOMETRY_FEEDBACK" general_feedback_prompt="PART1_GENERAL_FEEDBACK" format_prompt="REACTION_FORMAT_REMINDER" invalid_species_prompt="REACTION_INVALID_SPECIES" overlap_species_prompt="REACTION_OVERLAP_SPECIES" allowed_species="A,B,C,D">PART1_REACTION</step> -->
        <step type="prompt" delay="0" prompt="PART1_SOLUTION">PART1_SOLUTION_STEP</step>
        <step type="ready_secret" delay="0" pattern="(?i)^\s*done\s*$" required_participants="2" ack_prompt="READY_ACK">PART1_SOLUTION_DONE</step>
        <step type="chatlog" delay="0">CHAT_LOG</step>
    </stage>
    <stage name="StagePart2" type="other" delay="0">
        <step type="send_command" delay="0" state_key="CURRENT_PART_COMMAND" state_value="SHOW_VLAB2">SHOW_VLAB2</step>
        <step type="prompt" delay="5" prompt="PART2_QUESTION">PART2_QUESTION</step>
        <step type="prompt" delay="0" prompt="PART2_CONCENTRATION_REMINDER">PART2_CONCENTRATION_REMINDER</step>
        <step type="prompt" delay="0" prompt="PART2_REACTANTS_PROMPT">PART2_REACTANTS_PROMPT_STEP</step>
        <step type="ready_secret" delay="0" pattern="(?i)^\s*ready\s*:\s*part2\s*$" required_participants="2" secret_property="PART2_SECRET_WORD" secret_flag="PART2_SECRET_TRIGGERED" ack_prompt="READY_ACK">PART2_READY_REACTANTS</step>
        <step type="prompt" delay="0" prompt="PART2_REACTANTS_SUBMIT">PART2_REACTANTS_SUBMIT_STEP</step>
        <step type="reaction" delay="0" attempts="unlimited" expected_reactions="${PART2_EXPECTED|A+2C-&gt;B+D;B+2C-&gt;E}" success_prompt="PART2_REACTANTS_CORRECT" retry_prompt="PART2_REACTANTS_RETRY" general_feedback_prompt="PART2_REACTANTS_WRONG" format_prompt="REACTANT_FORMAT_REMINDER" invalid_species_prompt="REACTION_INVALID_SPECIES" allowed_species="A,B,C,D" input_prefix="reactants" evaluation_mode="reactants_only">PART2_REACTANTS_CHECK</step>
        <step type="ready_secret" delay="0" pattern="(?i)^\s*ready\s*:\s*part2\s*$" required_participants="2" ack_prompt="READY_ACK">PART2_READY_FINAL</step>
        <step type="prompt" delay="0" prompt="PART2_SUBMIT_PROMPT">PART2_SUBMIT_PROMPT</step>
        <step type="reaction" delay="0" attempts="3" expected_reactions="${PART2_EXPECTED|A+2C-&gt;B+D;B+2C-&gt;E}" secret_flag="PART2_SECRET_TRIGGERED" success_prompt="PART2_CORRECT" retry_prompt="PART2_RETRY" failure_prompt="PART2_FAILURE" reactant_feedback_prompt="PART2_REACTANT_FEEDBACK" product_feedback_prompt="PART2_PRODUCT_FEEDBACK" stoichiometry_feedback_prompt="PART2_STOICHIOMETRY_FEEDBACK" general_feedback_prompt="PART2_GENERAL_FEEDBACK" format_prompt="REACTION_FORMAT_REMINDER" invalid_species_prompt="REACTION_INVALID_SPECIES" overlap_species_prompt="REACTION_OVERLAP_SPECIES" allowed_species="A,B,C,D">PART2_REACTION</step>
        <step type="prompt" delay="0" prompt="PART2_SOLUTION">PART2_SOLUTION_STEP</step>
        <step type="ready_secret" delay="0" pattern="(?i)^\s*done\s*$" required_participants="2" ack_prompt="READY_ACK">PART2_SOLUTION_DONE</step>
        <step type="chatlog" delay="0">CHAT_LOG</step>
    </stage>
    <stage name="StagePart3" type="other" delay="0">
        <step type="send_command" delay="0" state_key="CURRENT_PART_COMMAND" state_value="SHOW_VLAB3">SHOW_VLAB3</step>
        <step type="prompt" delay="5" prompt="PART3_QUESTION">PART3_QUESTION</step>
        <step type="prompt" delay="0" prompt="PART3_REACTANTS_PROMPT">PART3_REACTANTS_PROMPT_STEP</step>
        <step type="ready_secret" delay="0" pattern="(?i)^\s*ready\s*:\s*part3\s*$" required_participants="2" secret_property="PART3_SECRET_WORD" secret_flag="PART3_SECRET_TRIGGERED" ack_prompt="READY_ACK">PART3_READY_REACTANTS</step>
        <step type="prompt" delay="0" prompt="PART3_REACTANTS_SUBMIT">PART3_REACTANTS_SUBMIT_STEP</step>
        <step type="reaction" delay="0" attempts="unlimited" expected_reactions="${PART3_EXPECTED|A+B-&gt;C}" success_prompt="PART3_REACTANTS_CORRECT" retry_prompt="PART3_REACTANTS_RETRY" general_feedback_prompt="PART3_REACTANTS_WRONG" format_prompt="REACTANT_FORMAT_REMINDER" invalid_species_prompt="REACTION_INVALID_SPECIES" allowed_species="A,B,C,D" input_prefix="reactants" evaluation_mode="reactants_only">PART3_REACTANTS_CHECK</step>
        <step type="ready_secret" delay="0" pattern="(?i)^\s*ready\s*:\s*part3\s*$" required_participants="2" ack_prompt="READY_ACK">PART3_READY_FINAL</step>
        <step type="prompt" delay="0" prompt="PART3_SUBMIT_PROMPT">PART3_SUBMIT_PROMPT</step>
        <step type="reaction" delay="0" attempts="3" expected_reactions="${PART3_EXPECTED|A+B-&gt;C}" secret_flag="PART3_SECRET_TRIGGERED" success_prompt="PART3_CORRECT" retry_prompt="PART3_RETRY" failure_prompt="PART3_FAILURE" reactant_feedback_prompt="PART3_REACTANT_FEEDBACK" product_feedback_prompt="PART3_PRODUCT_FEEDBACK" stoichiometry_feedback_prompt="PART3_STOICHIOMETRY_FEEDBACK" general_feedback_prompt="PART3_GENERAL_FEEDBACK" format_prompt="REACTION_FORMAT_REMINDER" retry_choice_prompt="PART3_RETRY_CHOICE" retry_choice_yes_pattern="(?i)^\s*yes\s*$" retry_choice_no_pattern="(?i)^\s*no\s*$" retry_choice_ack_prompt="PART3_RETRY_ACK" invalid_species_prompt="REACTION_INVALID_SPECIES" overlap_species_prompt="REACTION_OVERLAP_SPECIES" allowed_species="A,B,C,D">PART3_REACTION</step>
        <step type="prompt" delay="0" prompt="PART3_SOLUTION">PART3_SOLUTION_STEP</step>
        <step type="ready_secret" delay="0" pattern="(?i)^\s*done\s*$" required_participants="2" ack_prompt="READY_ACK">PART3_SOLUTION_DONE</step>
        <step type="chatlog" delay="0">CHAT_LOG</step>
    </stage>
    <stage name="StagePart4" type="other" delay="0">
        <step type="send_command" delay="0" state_key="CURRENT_PART_COMMAND" state_value="SHOW_VLAB4">SHOW_VLAB4</step>
        <step type="prompt" delay="5" prompt="PART4_QUESTION">PART4_QUESTION</step>
        <step type="prompt" delay="0" prompt="PART4_COLLAB">PART4_COLLAB</step>
        <step type="ready_secret" delay="0" pattern="(?i)^\s*ready\s*:\s*part4\s*$" required_participants="2" secret_property="PART4_SECRET_WORD" secret_flag="PART4_SECRET_TRIGGERED" ack_prompt="READY_ACK">PART4_READY</step>
        <step type="prompt" delay="0" prompt="PART4_SUBMIT_PROMPT">PART4_SUBMIT_PROMPT</step>
        <step type="reaction" delay="0" attempts="unlimited" expected_reactions="${PART4_EXPECTED|A+B-&gt;C}" secret_flag="PART4_SECRET_TRIGGERED" success_prompt="PART4_CORRECT" retry_prompt="PART4_RETRY" failure_prompt="PART4_FAILURE" reactant_feedback_prompt="PART4_REACTANT_FEEDBACK" product_feedback_prompt="PART4_PRODUCT_FEEDBACK" stoichiometry_feedback_prompt="PART4_STOICHIOMETRY_FEEDBACK" general_feedback_prompt="PART4_GENERAL_FEEDBACK" format_prompt="REACTION_FORMAT_REMINDER" invalid_species_prompt="REACTION_INVALID_SPECIES" overlap_species_prompt="REACTION_OVERLAP_SPECIES" allowed_species="A,B,C,D">PART4_REACTION</step>
        <step type="prompt" delay="0" prompt="PART4_SOLUTION">PART4_SOLUTION_STEP</step>
        <step type="ready_secret" delay="0" pattern="(?i)^\s*done\s*$" required_participants="2" ack_prompt="READY_ACK">PART4_SOLUTION_DONE</step>
        <step type="prompt" delay="0" prompt="PART4_POSTTEST">PART4_POSTTEST</step>
        <step type="no-op" delay="10">PART4_WAIT</step>
        <step type="chatlog" delay="0">CHAT_LOG</step>
        <step type="send_end" delay="0">SEND_END</step>
    </stage>
    <stage name="EndStage" type="other" delay="0" timeout="20000">  
        <step type="chatlog" delay="2" >CHAT_LOG</step> 
        <step type="logout" delay="0">LOGOUT</step>
    </stage>
</plan>
